<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>روبوت مدرسة الثروات الذكي</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0d4f3c;
            --primary-light: #1a7a5e;
            --primary-dark: #083328;
            --secondary: #c9a227;
            --secondary-light: #dbb84a;
            --secondary-dark: #a8871f;
            --accent: #e8f5f0;
            --bg-main: #f5f7f6;
            --bg-card: #ffffff;
            --bg-chat: #eef2f0;
            --bg-sidebar: #ffffff;
            --text-primary: #1a2e23;
            --text-secondary: #4a5f52;
            --text-muted: #7a8f82;
            --border: #d4e0d9;
            --shadow: rgba(13, 79, 60, 0.08);
            --shadow-lg: rgba(13, 79, 60, 0.15);
            --bot-bubble: #ffffff;
            --user-bubble: linear-gradient(135deg, #0d4f3c 0%, #1a7a5e 100%);
            --user-text: #ffffff;
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --gradient-gold: linear-gradient(135deg, #c9a227 0%, #dbb84a 50%, #c9a227 100%);
            --gradient-green: linear-gradient(135deg, #0d4f3c 0%, #1a7a5e 100%);
        }

        .dark {
            --primary: #2dd4a8;
            --primary-light: #4ade80;
            --primary-dark: #22a882;
            --secondary: #fbbf24;
            --secondary-light: #fcd34d;
            --secondary-dark: #d4a21a;
            --accent: #0f2922;
            --bg-main: #060f0b;
            --bg-card: #0c1a14;
            --bg-chat: #081210;
            --bg-sidebar: #0a1611;
            --text-primary: #e8f5f0;
            --text-secondary: #a8c4b8;
            --text-muted: #6a8a7a;
            --border: #1a3328;
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-lg: rgba(0, 0, 0, 0.5);
            --bot-bubble: #0f231b;
            --user-bubble: linear-gradient(135deg, #2dd4a8 0%, #22a882 100%);
            --user-text: #081210;
            --gradient-gold: linear-gradient(135deg, #fbbf24 0%, #fcd34d 50%, #fbbf24 100%);
            --gradient-green: linear-gradient(135deg, #2dd4a8 0%, #4ade80 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 320px;
            background: var(--bg-sidebar);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .sidebar.collapsed {
            width: 0;
            border: none;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 1.25rem;
            background: var(--gradient-green);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-logo {
            width: 50px;
            height: 50px;
            background: var(--gradient-gold);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(201, 162, 39, 0.3);
        }

        .sidebar-logo i {
            font-size: 1.5rem;
            color: var(--primary-dark);
        }

        .sidebar-title {
            flex: 1;
        }

        .sidebar-title h2 {
            color: #fff;
            font-size: 1.1rem;
            font-weight: 800;
        }

        .sidebar-title p {
            color: rgba(255,255,255,0.8);
            font-size: 0.75rem;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .sidebar-content::-webkit-scrollbar {
            width: 4px;
        }

        .sidebar-content::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        .category {
            margin-bottom: 1rem;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.75rem;
            background: var(--accent);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0.5rem;
        }

        .category-header:hover {
            background: var(--border);
        }

        .category-header i {
            width: 32px;
            height: 32px;
            background: var(--gradient-green);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 0.85rem;
        }

        .category-header span {
            flex: 1;
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .category-header .arrow {
            color: var(--text-muted);
            transition: transform 0.3s ease;
        }

        .category.open .category-header .arrow {
            transform: rotate(180deg);
        }

        .category-questions {
            display: none;
            padding-right: 0.5rem;
        }

        .category.open .category-questions {
            display: block;
        }

        .question-btn {
            width: 100%;
            text-align: right;
            padding: 0.7rem 1rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-family: 'Tajawal', sans-serif;
            font-size: 0.85rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .question-btn:hover {
            background: var(--accent);
            color: var(--primary);
            padding-right: 1.5rem;
        }

        .question-btn i {
            color: var(--secondary);
            font-size: 0.7rem;
        }

        .history-section {
            border-top: 1px solid var(--border);
            padding: 1rem;
        }

        .history-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .history-header h3 {
            font-size: 0.9rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .history-header h3 i {
            color: var(--secondary);
        }

        .clear-history-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            padding: 0.3rem 0.6rem;
            border-radius: 5px;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.2s ease;
        }

        .clear-history-btn:hover {
            background: var(--error);
            color: #fff;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 0.75rem;
            background: var(--bg-main);
            border-radius: 8px;
            margin-bottom: 0.4rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .history-item:hover {
            background: var(--accent);
            color: var(--primary);
        }

        .history-item i {
            color: var(--text-muted);
            font-size: 0.7rem;
        }

        .history-item span {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .no-history {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.8rem;
            padding: 1rem;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: var(--bg-card);
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 2px 10px var(--shadow);
        }

        .toggle-sidebar-btn {
            width: 42px;
            height: 42px;
            background: var(--accent);
            border: none;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--primary);
        }

        .toggle-sidebar-btn:hover {
            background: var(--primary);
            color: #fff;
        }

        .header-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .bot-avatar {
            width: 48px;
            height: 48px;
            background: var(--gradient-gold);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(201, 162, 39, 0.25);
            position: relative;
        }

        .bot-avatar i {
            font-size: 1.4rem;
            color: var(--primary-dark);
        }

        .bot-avatar::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            border: 2px solid var(--bg-card);
        }

        .header-text h1 {
            font-size: 1.15rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.15rem;
        }

        .header-text p {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            width: 42px;
            height: 42px;
            background: var(--accent);
            border: none;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            position: relative;
        }

        .action-btn:hover {
            background: var(--primary);
            color: #fff;
        }

        .action-btn .tooltip {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: var(--bg-card);
            padding: 0.4rem 0.7rem;
            border-radius: 6px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .action-btn:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-chat);
            overflow: hidden;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .welcome-section {
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
            padding: 2rem 1rem;
        }

        .welcome-icon {
            width: 100px;
            height: 100px;
            background: var(--gradient-green);
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            box-shadow: 0 10px 40px var(--shadow-lg);
            animation: float 4s ease-in-out infinite;
            position: relative;
        }

        .welcome-icon::before {
            content: '';
            position: absolute;
            inset: -4px;
            background: var(--gradient-gold);
            border-radius: 30px;
            z-index: -1;
            opacity: 0.5;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-12px) rotate(2deg); }
        }

        .welcome-icon i {
            font-size: 3rem;
            color: #fff;
        }

        .welcome-section h2 {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .welcome-section > p {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .stats-row {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 1rem 1.5rem;
            border-radius: 14px;
            box-shadow: 0 4px 20px var(--shadow);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border: 1px solid var(--border);
        }

        .stat-icon {
            width: 45px;
            height: 45px;
            background: var(--accent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .stat-info h4 {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--primary);
        }

        .stat-info p {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .quick-action-btn {
            background: var(--bg-card);
            border: 2px solid var(--border);
            padding: 1rem;
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.6rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Tajawal', sans-serif;
        }

        .quick-action-btn:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 25px var(--shadow-lg);
        }

        .quick-action-btn i {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .quick-action-btn:hover i {
            background: var(--gradient-green);
            color: #fff;
        }

        .quick-action-btn span {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .message {
            display: flex;
            gap: 0.75rem;
            max-width: 80%;
            animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .message.user {
            flex-direction: row-reverse;
            align-self: flex-start;
        }

        .message.bot {
            align-self: flex-end;
        }

        .message-avatar {
            width: 38px;
            height: 38px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message.bot .message-avatar {
            background: var(--gradient-gold);
            color: var(--primary-dark);
        }

        .message.user .message-avatar {
            background: var(--gradient-green);
            color: #fff;
        }

        .message-bubble {
            padding: 1rem 1.25rem;
            border-radius: 18px;
            line-height: 1.75;
            font-size: 0.95rem;
            position: relative;
        }

        .message.bot .message-bubble {
            background: var(--bot-bubble);
            color: var(--text-primary);
            border-bottom-right-radius: 6px;
            box-shadow: 0 3px 15px var(--shadow);
            border: 1px solid var(--border);
        }

        .message.user .message-bubble {
            background: var(--user-bubble);
            color: var(--user-text);
            border-bottom-left-radius: 6px;
            box-shadow: 0 3px 15px var(--shadow-lg);
        }

        .message-bubble h4 {
            color: var(--primary);
            margin-bottom: 0.6rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark .message-bubble h4 {
            color: var(--secondary);
        }

        .message-bubble ul, .message-bubble ol {
            margin: 0.6rem 0;
            padding-right: 1.3rem;
        }

        .message-bubble li {
            margin: 0.4rem 0;
        }

        .message-bubble strong {
            color: var(--primary);
        }

        .dark .message-bubble strong {
            color: var(--secondary);
        }

        .message-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            display: block;
        }

        .message.user .message-time {
            color: rgba(255,255,255,0.7);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            align-self: flex-end;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-avatar {
            width: 38px;
            height: 38px;
            border-radius: 12px;
            background: var(--gradient-gold);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-dark);
        }

        .typing-bubble {
            background: var(--bot-bubble);
            padding: 1rem 1.25rem;
            border-radius: 18px;
            border-bottom-right-radius: 6px;
            display: flex;
            gap: 0.4rem;
            box-shadow: 0 3px 15px var(--shadow);
            border: 1px solid var(--border);
        }

        .typing-bubble span {
            width: 10px;
            height: 10px;
            background: var(--primary);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .typing-bubble span:nth-child(1) { animation-delay: -0.32s; }
        .typing-bubble span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .input-area {
            background: var(--bg-card);
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .input-wrapper input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--border);
            border-radius: 16px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            background: var(--bg-main);
            color: var(--text-primary);
            transition: all 0.3s ease;
            outline: none;
        }

        .input-wrapper input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(13, 79, 60, 0.1);
        }

        .input-wrapper input::placeholder {
            color: var(--text-muted);
        }

        .send-btn {
            width: 52px;
            height: 52px;
            background: var(--gradient-green);
            border: none;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px var(--shadow-lg);
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.05) rotate(-5deg);
            box-shadow: 0 6px 25px var(--shadow-lg);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .send-btn i {
            color: #fff;
            font-size: 1.25rem;
            transform: rotate(180deg);
        }

        .back-to-questions {
            position: fixed;
            bottom: 100px;
            left: 20px;
            background: var(--gradient-gold);
            color: var(--primary-dark);
            border: none;
            padding: 0.75rem 1.25rem;
            border-radius: 30px;
            font-family: 'Tajawal', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 20px rgba(201, 162, 39, 0.4);
            transition: all 0.3s ease;
            z-index: 50;
        }

        .back-to-questions.visible {
            display: flex;
        }

        .back-to-questions:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(201, 162, 39, 0.5);
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 90;
        }

        .sidebar-overlay.active {
            display: block;
        }

        @media (max-width: 900px) {
            .sidebar {
                position: fixed;
                right: 0;
                top: 0;
                bottom: 0;
                width: 300px;
                z-index: 100;
                transform: translateX(100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar.collapsed {
                transform: translateX(100%);
            }
        }

        @media (max-width: 600px) {
            .header {
                padding: 0.75rem 1rem;
            }

            .bot-avatar {
                width: 42px;
                height: 42px;
            }

            .header-text h1 {
                font-size: 1rem;
            }

            .header-actions {
                gap: 0.3rem;
            }

            .action-btn {
                width: 38px;
                height: 38px;
            }

            .messages-container {
                padding: 1rem;
            }

            .message {
                max-width: 90%;
            }

            .welcome-section {
                padding: 1.5rem 1rem;
            }

            .welcome-icon {
                width: 80px;
                height: 80px;
            }

            .welcome-icon i {
                font-size: 2.2rem;
            }

            .welcome-section h2 {
                font-size: 1.4rem;
            }

            .stats-row {
                gap: 0.75rem;
            }

            .stat-card {
                padding: 0.75rem 1rem;
            }

            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }

            .input-area {
                padding: 0.75rem 1rem;
            }

            .input-wrapper input {
                padding: 0.9rem 1rem;
                font-size: 16px;
            }

            .send-btn {
                width: 48px;
                height: 48px;
            }

            .back-to-questions {
                bottom: 90px;
                left: 15px;
                padding: 0.6rem 1rem;
                font-size: 0.8rem;
            }
        }

        .scroll-top-btn {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 45px;
            height: 45px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            z-index: 50;
        }

        .scroll-top-btn.visible {
            display: flex;
        }

        .scroll-top-btn:hover {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <div class="main-content">
            <header class="header">
                <button class="toggle-sidebar-btn" id="toggleSidebarBtn">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="header-info">
                    <div class="bot-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="header-text">
                        <h1>مدرسة الثروات الخاصة</h1>
                        <p>المساعد الذكي • متصل الآن</p>
                    </div>
                </div>

                <div class="header-actions">
                    <button class="action-btn" id="homeBtn" title="بداية جديدة">
                        <i class="fas fa-home"></i>
                        <span class="tooltip">الرئيسية</span>
                    </button>
                    <button class="action-btn" id="clearBtn" title="مسح المحادثة">
                        <i class="fas fa-trash-alt"></i>
                        <span class="tooltip">مسح</span>
                    </button>
                </div>
            </header>

            <div class="chat-area">
                <div class="messages-container" id="messagesContainer">
                    <div class="welcome-section" id="welcomeSection">
                        <div class="welcome-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <h2>أهلاً وسهلاً بكم!</h2>
                        <p>أنا المساعد الذكي لمدرسة الثروات الخاصة. يسعدني خدمتكم والإجابة على جميع استفساراتكم.</p>

                        <div class="stats-row">
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-user-graduate"></i></div>
                                <div class="stat-info">
                                    <h4>1600</h4>
                                    <p>طالب وطالبة</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                                <div class="stat-info">
                                    <h4>108</h4>
                                    <p>معلم ومعلمة</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-award"></i></div>
                                <div class="stat-info">
                                    <h4>10+</h4>
                                    <p>سنوات خبرة</p>
                                </div>
                            </div>
                        </div>

                        <div class="quick-actions" id="quickActions">
                            <button class="quick-action-btn" data-question="ما هي مدرسة الثروات؟">
                                <i class="fas fa-school"></i>
                                <span>عن المدرسة</span>
                            </button>
                            <button class="quick-action-btn" data-question="كيف يتم التسجيل في المدرسة؟">
                                <i class="fas fa-user-plus"></i>
                                <span>التسجيل</span>
                            </button>
                            <button class="quick-action-btn" data-question="ما الرسوم الدراسية؟">
                                <i class="fas fa-coins"></i>
                                <span>الرسوم</span>
                            </button>
                            <button class="quick-action-btn" data-question="ما أوقات الدوام المدرسي؟">
                                <i class="fas fa-clock"></i>
                                <span>الدوام</span>
                            </button>
                            <button class="quick-action-btn" data-question="هل يتوفر نقل مدرسي؟">
                                <i class="fas fa-bus-alt"></i>
                                <span>النقل</span>
                            </button>
                            <button class="quick-action-btn" data-question="ما المناهج المعتمدة في المدرسة؟">
                                <i class="fas fa-book-open"></i>
                                <span>المناهج</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="typing-bubble">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>

                <div class="input-area">
                    <div class="input-wrapper">
                        <input
                            type="text"
                            id="userInput"
                            placeholder="اكتب سؤالك هنا..."
                            autocomplete="off"
                        >
                    </div>
                    <button class="send-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-school"></i>
                </div>
                <div class="sidebar-title">
                    <h2>الأسئلة الشائعة</h2>
                    <p>اختر من القائمة</p>
                </div>
            </div>

            <div class="sidebar-content" id="sidebarContent">
                <div class="category open" data-category="about">
                    <div class="category-header">
                        <i class="fas fa-info-circle"></i>
                        <span>عن المدرسة</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="category-questions">
                        <button class="question-btn" data-question="ما هي مدرسة الثروات؟">
                            <i class="fas fa-circle"></i>
                            ما هي مدرسة الثروات؟
                        </button>
                        <button class="question-btn" data-question="أين يقع مقر المدرسة؟">
                            <i class="fas fa-circle"></i>
                            أين يقع مقر المدرسة؟
                        </button>
                        <button class="question-btn" data-question="ما المراحل الدراسية المتوفرة؟">
                            <i class="fas fa-circle"></i>
                            المراحل الدراسية المتوفرة
                        </button>
                        <button class="question-btn" data-question="هل المدرسة معتمدة رسمياً؟">
                            <i class="fas fa-circle"></i>
                            هل المدرسة معتمدة رسمياً؟
                        </button>
                        <button class="question-btn" data-question="هل المدرسة آمنة للأطفال؟">
                            <i class="fas fa-circle"></i>
                            هل المدرسة آمنة للأطفال؟
                        </button>
                    </div>
                </div>

                <div class="category" data-category="registration">
                    <div class="category-header">
                        <i class="fas fa-user-plus"></i>
                        <span>التسجيل والقبول</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="category-questions">
                        <button class="question-btn" data-question="كيف يتم التسجيل في المدرسة؟">
                            <i class="fas fa-circle"></i>
                            كيف يتم التسجيل؟
                        </button>
                        <button class="question-btn" data-question="ما المستندات المطلوبة للتسجيل؟">
                            <i class="fas fa-circle"></i>
                            المستندات المطلوبة
                        </button>
                        <button class="question-btn" data-question="ما أعمار القبول في رياض الأطفال؟">
                            <i class="fas fa-circle"></i>
                            أعمار القبول
                        </button>
                        <button class="question-btn" data-question="هل يوجد اختبار قبول؟">
                            <i class="fas fa-circle"></i>
                            اختبار القبول
                        </button>
                        <button class="question-btn" data-question="كيف يمكن حجز موعد زيارة للمدرسة؟">
                            <i class="fas fa-circle"></i>
                            حجز موعد زيارة
                        </button>
                    </div>
                </div>

                <div class="category" data-category="fees">
                    <div class="category-header">
                        <i class="fas fa-coins"></i>
                        <span>الرسوم المدرسية</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="category-questions">
                        <button class="question-btn" data-question="ما الرسوم الدراسية؟">
                            <i class="fas fa-circle"></i>
                            الرسوم الدراسية
                        </button>
                        
                    </div>
                </div>

                <div class="category" data-category="curriculum">
                    <div class="category-header">
                        <i class="fas fa-book"></i>
                        <span>المناهج والتعليم</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="category-questions">
                        <button class="question-btn" data-question="ما المناهج المعتمدة في المدرسة؟">
                            <i class="fas fa-circle"></i>
                            المناهج المعتمدة
                        </button>
                        <button class="question-btn" data-question="ما لغة التدريس؟">
                            <i class="fas fa-circle"></i>
                            لغة التدريس
                        </button>
                        <button class="question-btn" data-question="هل يوجد تعليم تقوية للطلاب؟">
                            <i class="fas fa-circle"></i>
                            تعليم التقوية
                        </button>
                        <button class="question-btn" data-question="كيف يتم تقييم الطلاب؟">
                            <i class="fas fa-circle"></i>
                            تقييم الطلاب
                        </button>
                        <button class="question-btn" data-question="هل يوجد تعليم إلكتروني؟">
                            <i class="fas fa-circle"></i>
                            التعليم الإلكتروني
                        </button>
                    </div>
                </div>

                <div class="category" data-category="schedule">
                    <div class="category-header">
                        <i class="fas fa-clock"></i>
                        <span>الدوام والحضور</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="category-questions">
                        <button class="question-btn" data-question="ما أوقات الدوام المدرسي؟">
                            <i class="fas fa-circle"></i>
                            أوقات الدوام
                        </button>
                        <button class="question-btn" data-question="كيف يتم التعامل مع الغياب؟">
                            <i class="fas fa-circle"></i>
                            سياسة الغياب
                        </button>
                        <button class="question-btn" data-question="هل توجد حضانة بعد الدوام؟">
                            <i class="fas fa-circle"></i>
                            حضانة بعد الدوام
                        </button>
                    </div>
                </div>

                <div class="category" data-category="transport">
                    <div class="category-header">
                        <i class="fas fa-bus"></i>
                        <span>النقل المدرسي</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="category-questions">
                        <button class="question-btn" data-question="هل يتوفر نقل مدرسي؟">
                            <i class="fas fa-circle"></i>
                            توفر النقل
                        </button>
                        <button class="question-btn" data-question="ما مناطق تغطية الباصات؟">
                            <i class="fas fa-circle"></i>
                            مناطق التغطية
                        </button>
                    </div>
                </div>

                <div class="category" data-category="activities">
                    <div class="category-header">
                        <i class="fas fa-futbol"></i>
                        <span>الأنشطة</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="category-questions">
                        <button class="question-btn" data-question="ما الأنشطة اللامنهجية المتوفرة؟">
                            <i class="fas fa-circle"></i>
                            الأنشطة اللامنهجية
                        </button>
                        <button class="question-btn" data-question="هل توجد أنشطة رياضية؟">
                            <i class="fas fa-circle"></i>
                            الأنشطة الرياضية
                        </button>
                    </div>
                </div>

                <div class="category" data-category="facilities">
                    <div class="category-header">
                        <i class="fas fa-building"></i>
                        <span>المرافق والخدمات</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="category-questions">
                        <button class="question-btn" data-question="ما عدد الطلاب في الفصل الواحد؟">
                            <i class="fas fa-circle"></i>
                            عدد الطلاب بالفصل
                        </button>
                        <button class="question-btn" data-question="هل المدرسة مختلطة؟">
                            <i class="fas fa-circle"></i>
                            نظام الفصول
                        </button>
                        <button class="question-btn" data-question="هل المدرسة توفر وجبات؟">
                            <i class="fas fa-circle"></i>
                            الوجبات
                        </button>
                        <button class="question-btn" data-question="هل يوجد إشراف تربوي؟">
                            <i class="fas fa-circle"></i>
                            الإشراف التربوي
                        </button>
                    </div>
                </div>

                <div class="category" data-category="contact">
                    <div class="category-header">
                        <i class="fas fa-phone-alt"></i>
                        <span>التواصل</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </div>
                    <div class="category-questions">
                        <button class="question-btn" data-question="هل يتم التواصل مع أولياء الأمور؟">
                            <i class="fas fa-circle"></i>
                            التواصل مع الأهل
                        </button>
                        <button class="question-btn" data-question="ما طرق التواصل مع الإدارة؟">
                            <i class="fas fa-circle"></i>
                            طرق التواصل
                        </button>
                    </div>
                </div>
            </div>

            <div class="history-section">
                <div class="history-header">
                    <h3><i class="fas fa-history"></i> الأسئلة السابقة</h3>
                    <button class="clear-history-btn" id="clearHistoryBtn">مسح الكل</button>
                </div>
                <div class="history-list" id="historyList">
                    <div class="no-history" id="noHistory">لا توجد أسئلة سابقة</div>
                </div>
            </div>
        </aside>
    </div>

    <button class="back-to-questions" id="backToQuestions">
        <i class="fas fa-arrow-up"></i>
        العودة للأعلى
    </button>

    <button class="scroll-top-btn" id="scrollTopBtn">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(event) {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Knowledge Base with Q&A pairs
        const knowledgeBase = {
            'ما هي مدرسة الثروات': {
                answer: `<h4><i class="fas fa-school"></i> مدرسة الثروات الخاصة</h4>
                <p><strong>مدرسة الثروات الخاصة</strong> هي مؤسسة تعليمية متميزة ومعتمدة رسمياً من وزارة التربية والتعليم.</p>
                <ul>
                    <li><strong>الرؤية:</strong> بناء جيل متعلم ومبدع قادر على مواكبة التطور</li>
                    <li><strong>الرسالة:</strong> توفير بيئة تعليمية آمنة وحديثة تعتمد على أساليب تعليم متطورة</li>
                </ul>`
            },
            'أين يقع مقر المدرسة': {
                answer: `<h4><i class="fas fa-map-marker-alt"></i> تقع مدرسة الثروات الوطنيه الخاصه في في بني شرق 9 </h4>
                <p> للحصول علي العنوان التفصيلي والموقع الجغرافي، يرجي فتح الرابط <a href="https://maps.app.goo.gl/x2Pms7Uq3oEtp4pH9?g_st=ac">افتح الموقع</a>   .</p>
                <p>يسعدنا استقبالكم في أي وقت خلال ساعات الدوام الرسمية.</p>`
            },
            'ما المراحل الدراسية': {
                answer: `<h4><i class="fas fa-graduation-cap"></i> المراحل الدراسية المتوفرة</h4>
                <ul>
                    <li><strong>رياض الأطفال:</strong> KG1 و KG2</li>
                    <li><strong>المرحلة الأساسية:</strong> من الصف الأول حتى الصف التاسع</li>
                </ul>
                <li><strong>المرحلة الثانويه:</strong> من الصف العاشر حتى الصف الثاني عشر</li>`
            },
            'هل المدرسة معتمدة': {
                answer: `<h4><i class="fas fa-certificate"></i> الاعتماد الرسمي</h4>
                <p><strong>نعم،</strong> مدرسة الثروات الخاصة معتمدة رسمياً من وزارة التربية والتعليم وتلتزم بجميع المعايير والمتطلبات الحكومية.</p>`
            },
            'هل المدرسة آمنة': {
                answer: `<h4><i class="fas fa-shield-alt"></i> الأمان والسلامة</h4>
                <p><strong>نعم،</strong> نحرص على توفير بيئة آمنة تماماً لأطفالكم:</p>
                <ul>
                    <li>نظام كاميرات مراقبة شامل</li>
                    <li>حراسة أمنية على مدار الساعة</li>
                    <li>بوابات إلكترونية للدخول والخروج</li>
                    <li>إجراءات صارمة لتسليم الطلاب</li>
                    <li>تدريبات إخلاء دورية</li>
                    <li>بيئة نظيفة ومعقمة</li>
                </ul>`
            },
            'كيف يتم التسجيل': {
                answer: `<h4><i class="fas fa-user-plus"></i> إجراءات التسجيل</h4>
                <p>يتم التسجيل وفق الخطوات التالية:</p>
                <ol>
                    <li>زيارة المدرسة أو التواصل هاتفياً</li>
                    <li>تعبئة نموذج طلب الالتحاق</li>
                    <li>تقديم المستندات المطلوبة</li>
                    <li>إجراء مقابلة بسيطة للطالب (للمراحل الأساسية)</li>
                    <li>استلام إشعار القبول</li>
                    <li>دفع الرسوم وتأكيد التسجيل</li>
                </ol>`
            },
            'ما المستندات المطلوبة': {
                answer: `<h4><i class="fas fa-file-alt"></i> المستندات المطلوبة للتسجيل</h4>
                <ul>
                    <li>شهادة ميلاد الطالب</li>
                    <li>صور شخصية حديثة (4 صور)</li>
                    <li>دفتر التطعيمات</li>
                    <li>صورة عن هوية ولي الأمر</li>
                    <li>الشهادة المدرسية السابقة (للمنقولين)</li>
                    <li>شهادة حسن سير وسلوك (للمنقولين)</li>
                </ul>`
            },
            'ما أعمار القبول': {
                answer: `<h4><i class="fas fa-child"></i> أعمار القبول في رياض الأطفال</h4>
                <ul>
                    <li><strong>KG1:</strong> من 3.5 إلى 4.5 سنوات</li>
                    <li><strong>KG2:</strong> من 4.5 إلى 5.5 سنوات</li>
                </ul>`
            },
            'هل يوجد اختبار قبول': {
                answer: `<h4><i class="fas fa-clipboard-check"></i> اختبار القبول</h4>
                <p>يتم إجراء <strong>مقابلة بسيطة</strong> لتقييم مستوى الطالب.</p>
                <ul>
                    <li>لا يوجد اختبار قبول صعب</li>
                    <li>الهدف هو التعرف على الطالب ومستواه</li>
                    <li>المقابلة ودية ومشجعة</li>
                </ul>`
            },
            'حجز موعد زيارة': {
                answer: `<h4><i class="fas fa-calendar-check"></i> حجز موعد زيارة</h4>
                <p>يسعدنا استقبالكم! لحجز موعد:</p>
                <ul>
                    <li>الاتصال بإدارة المدرسة لتحديد موعد</li>
                    <li>زيارة المدرسة خلال أوقات الدوام</li>
                    <li>ستحظون بجولة تعريفية في المرافق</li>
                    <li>لقاء مع المسؤولين للإجابة على استفساراتكم</li>
                </ul>`
            },
            'ما الرسوم الدراسية': {
                answer: `<h4><i class="fas fa-coins"></i> الرسوم الدراسية</h4>
                <p>الرسوم الدراسية تختلف حسب المرحلة الدراسية.</p>
                <ul>
                    <li>للاطلاع على الرسوم التفصيلية يرجى التواصل مع قسم الحسابات</li>
                    <li>تشمل الرسوم: الكتب، الزي المدرسي، والأنشطة</li>
                </ul>`
            },
            

            
            'ما المناهج المعتمدة': {
                answer: `<h4><i class="fas fa-book"></i> المناهج المعتمدة</h4>
                <ul>
                    <li>المنهاج الوطني المعتمد من وزارة التربية والتعليم</li>
                    <li>يتم تعزيزه ببرامج تعليمية حديثة ومتطورة</li>
                    <li>التركيز على تنمية مهارات التفكير والإبداع</li>
                </ul>`
            },
            'ما لغة التدريس': {
                answer: `<h4><i class="fas fa-language"></i> لغة التدريس</h4>
                <p>تعد اللغه العربيه هي اللغه الرسمية في تدريس المواد </p>
                <ul>
                    `
            },
            'تعليم تقوية': {
                answer: `<h4><i class="fas fa-hands-helping"></i> التعليم التقوية</h4>
                <p><strong>نعم،</strong> نوفر برنامج تقوية متكامل:</p>
                <ul>
                    <li>حصص تقوية للطلاب المحتاجين</li>
                    <li>دعم فردي في المواد الأساسية</li>
                    <li>متابعة مستمرة لتحسين المستوى</li>
                </ul>`
            },
            'كيف يتم تقييم الطلاب': {
                answer: `<h4><i class="fas fa-chart-line"></i> تقييم الطلاب</h4>
                <ul>
                    <li>تقييم مستمر خلال العام الدراسي</li>
                    <li>اختبارات شهرية وفصلية</li>
                    <li>تقارير مفصلة لولي الأمر</li>
                    <li>تقييم شامل للمهارات والسلوك</li>
                </ul>`
            },
            'تعليم إلكتروني': {
                answer: `<h4><i class="fas fa-laptop"></i> التعليم الإلكتروني</h4>
                <p><strong>نعم،</strong> نوفر منصة تعليم إلكتروني متكاملة:</p>
                <ul>
                    <li>دروس مسجلة وتفاعلية</li>
                    <li>واجبات إلكترونية</li>
                    <li>تواصل مع المعلمين عبر المنصة</li>
                </ul>`
            },
            'ما أوقات الدوام': {
                answer: `<h4><i class="fas fa-clock"></i> أوقات الدوام المدرسي</h4>
                <p><strong>أيام الدوام:</strong> من الأتنين إلى الجمعة</p>
                <ul>
                    <li><strong> جميع المراحل الدراسيه:</strong> 7:30 صباحاً - 02:15 مساءا</li>
                   
                </ul>`
            },
            'الغياب': {
                answer: `<h4><i class="fas fa-user-clock"></i> سياسة الغياب</h4>
                <ul>
                    <li>يتم إبلاغ ولي الأمر فور غياب الطالب</li>
                    <li>ضرورة تقديم عذر مقبول للغياب</li>
                    <li>متابعة مستمرة للحضور والانضباط</li>
                    <li>الغياب المتكرر قد يؤثر على التقييم</li>
                </ul>`
            },
            'حضانة بعد الدوام': {
                answer: `<h4><i class="fas fa-child"></i> خدمة ما بعد الدوام</h4>
                <p><strong>نعم،</strong> تتوفر خدمة رعاية بعد الدوام:</p>
                <ul>
                    <li>حتى الساعة 4:00 مساءً</li>
                    <li>برسوم إضافية بسيطة</li>
                    <li>إشراف تربوي وأنشطة ترفيهية</li>
                </ul>`
            },
            'هل يتوفر نقل مدرسي': {
                answer: `<h4><i class="fas fa-bus"></i> النقل المدرسي</h4>
                <p><strong>نعم،</strong> نوفر خدمة نقل مدرسي متميزة:</p>
                <ul>
                    <li>باصات حديثة ومكيفة</li>
                    <li>سائقون مدربون ومرافقات للأطفال</li>
                    <li>للاستفسار عن مناطق التغطية يرجى التواصل مع إدارة النقل</li>
                </ul>`
            },
            'مناطق تغطية الباصات': {
                answer: `<h4><i class="fas fa-map-marked-alt"></i> مناطق التغطية</h4>
                <p>للحصول على معلومات تفصيلية حول مناطق تغطية الباصات المدرسية، يرجى التواصل مع إدارة النقل المدرسي.
                علي الهاتف 0543837551</p>`
            },
            'الأنشطة اللامنهجية': {
                answer: `<h4><i class="fas fa-palette"></i> الأنشطة اللامنهجية</h4>
                <ul>
                    <li>نادي الفنون والرسم</li>
                    <li>نادي الإلقاء والخطابة</li>
                    <li>نادي العلوم والاكتشاف</li>
                    <li>نادي اللغة الإنجليزية</li>
                    <li>أنشطة موسيقية</li>
                    <li>مسابقات ثقافية</li>
                </ul>`
            },
            'أنشطة رياضية': {
                answer: `<h4><i class="fas fa-running"></i> الأنشطة الرياضية</h4>
                <ul>
                    <li>حصص التربية البدنية</li>
                    <li>كرة القدم</li>
                    <li>السباحة (إن توفرت)</li>
                    <li>ألعاب جماعية متنوعة</li>
                    <li>مسابقات رياضية</li>
                </ul>`
            },
            'عدد الطلاب في الفصل': {
                answer: `<h4><i class="fas fa-users"></i> عدد الطلاب في الفصل</h4>
                <p><strong>20-25 طالباً</strong> كحد أقصى في الفصل الواحد.</p>
                <p>هذا يضمن جودة التعليم والاهتمام الفردي بكل طالب.</p>`
            },
            'هل المدرسة مختلطة': {
                answer: `<h4><i class="fas fa-venus-mars"></i> نظام الفصول</h4>
                <ul>
                    <li><strong>رياض الأطفال:</strong> فصول مختلطة</li>
                    <li><strong>المراحل العليا:</strong> فصول منفصلة للذكور والإناث</li>
                </ul>`
            },
            'وجبات': {
                answer: `<h4><i class="fas fa-utensils"></i> الوجبات</h4>
                <ul>
                    <li>مقصف مدرسي يقدم وجبات صحية</li>
                    <li>إمكانية إحضار وجبة من المنزل</li>
                    <li>رقابة على جودة الأطعمة المقدمة</li>
                </ul>`
            },
            'إشراف تربوي': {
                answer: `<h4><i class="fas fa-user-tie"></i> الإشراف التربوي</h4>
                <p><strong>نعم،</strong> يتوفر إشراف تربوي متخصص:</p>
                <ul>
                    <li>متابعة مستمرة لأداء المعلمين</li>
                    <li>برامج تطوير مهني للكادر التعليمي</li>
                    <li>دعم تربوي للطلاب</li>
                </ul>`
            },
            'التواصل مع أولياء الأمور': {
                answer: `<h4><i class="fas fa-comments"></i> التواصل مع أولياء الأمور</h4>
                <ul>
                    <li>اجتماعات دورية لأولياء الأمور</li>
                    <li>تقارير شهرية عن مستوى الطالب</li>
                    <li>مجموعات 
                     تواصل إلكترونية</li>
                    <li>إشعارات فورية عبر التطبيق</li>
                </ul>`
            },
            'طرق التواصل مع الإدارة': {
                answer: `<h4><i class="fas fa-phone-alt"></i> طرق التواصل مع الإدارة</h4>
                <ul>
                    <li>زيارة المدرسة خلال أوقات الدوام</li>
                    <li>الاتصال الهاتفي رقم الهاتف 0543837551</li>
                    <li>البريد الالكتروني schoolsschool2019@gmail.com</li>
                    <li>وسائل التواصل الاجتماعي</li>
                </ul>`
            }
        };

        // DOM Elements
        const messagesContainer = document.getElementById('messagesContainer');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const welcomeSection = document.getElementById('welcomeSection');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const historyList = document.getElementById('historyList');
        const noHistory = document.getElementById('noHistory');
        const backToQuestions = document.getElementById('backToQuestions');
        const scrollTopBtn = document.getElementById('scrollTopBtn');
        const toggleSidebarBtn = document.getElementById('toggleSidebarBtn');
        const homeBtn = document.getElementById('homeBtn');
        const clearBtn = document.getElementById('clearBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const sidebarContent = document.getElementById('sidebarContent');
        const quickActions = document.getElementById('quickActions');

        // State
        let questionHistory = [];
        let isProcessing = false;

        // Find answer from knowledge base
        function findAnswer(question) {
            const normalizedQuestion = question.trim().replace(/؟/g, '').toLowerCase();

            for (const [key, value] of Object.entries(knowledgeBase)) {
                const normalizedKey = key.replace(/؟/g, '').toLowerCase();
                if (normalizedQuestion.includes(normalizedKey) || normalizedKey.includes(normalizedQuestion)) {
                    return value.answer;
                }
            }

            // Check for partial matches
            const keywords = {
                'مدرسة الثروات': 'ما هي مدرسة الثروات',
                'عن المدرسة': 'ما هي مدرسة الثروات',
                'الموقع': 'أين يقع مقر المدرسة',
                'العنوان': 'أين يقع مقر المدرسة',
                'المراحل': 'ما المراحل الدراسية',
                'الصفوف': 'ما المراحل الدراسية',
                'معتمدة': 'هل المدرسة معتمدة',
                'آمنة': 'هل المدرسة آمنة',
                'أمان': 'هل المدرسة آمنة',
                'السلامة': 'هل المدرسة آمنة',
                'تسجيل': 'كيف يتم التسجيل',
                'الالتحاق': 'كيف يتم التسجيل',
                'مستندات': 'ما المستندات المطلوبة',
                'أوراق': 'ما المستندات المطلوبة',
                'وثائق': 'ما المستندات المطلوبة',
                'أعمار': 'ما أعمار القبول',
                'عمر': 'ما أعمار القبول',
                'سن': 'ما أعمار القبول',
                'اختبار': 'هل يوجد اختبار قبول',
                'امتحان': 'هل يوجد اختبار قبول',
                'زيارة': 'حجز موعد زيارة',
                'موعد': 'حجز موعد زيارة',
                'رسوم': 'ما الرسوم الدراسية',
                'الأسعار': 'ما الرسوم الدراسية',
                'التكلفة': 'ما الرسوم الدراسية',
                'خصم': 'خصومات',
                'تقسيط': 'تقسيط',
                'دفعات': 'تقسيط',
                'مناهج': 'ما المناهج المعتمدة',
                'منهج': 'ما المناهج المعتمدة',
                'لغة': 'ما لغة التدريس',
                'إنجليزي': 'ما لغة التدريس',
                'تقوية': 'تعليم تقوية',
                'تقييم': 'كيف يتم تقييم الطلاب',
                'درجات': 'كيف يتم تقييم الطلاب',
                'علامات': 'كيف يتم تقييم الطلاب',
                'إلكتروني': 'تعليم إلكتروني',
                'أونلاين': 'تعليم إلكتروني',
                'دوام': 'ما أوقات الدوام',
                'وقت': 'ما أوقات الدوام',
                'ساعات': 'ما أوقات الدوام',
                'غياب': 'الغياب',
                'حضور': 'الغياب',
                'حضانة': 'حضانة بعد الدوام',
                'بعد الدوام': 'حضانة بعد الدوام',
                'نقل': 'هل يتوفر نقل مدرسي',
                'باص': 'هل يتوفر نقل مدرسي',
                'مواصلات': 'هل يتوفر نقل مدرسي',
                'تغطية': 'مناطق تغطية الباصات',
                'مناطق': 'مناطق تغطية الباصات',
                'أنشطة': 'الأنشطة اللامنهجية',
                'نشاط': 'الأنشطة اللامنهجية',
                'رياضة': 'أنشطة رياضية',
                'رياضي': 'أنشطة رياضية',
                'كرة': 'أنشطة رياضية',
                'عدد الطلاب': 'عدد الطلاب في الفصل',
                'فصل': 'عدد الطلاب في الفصل',
                'مختلط': 'هل المدرسة مختلطة',
                'بنات': 'هل المدرسة مختلطة',
                'بنين': 'هل المدرسة مختلطة',
                'طعام': 'وجبات',
                'وجبة': 'وجبات',
                'أكل': 'وجبات',
                'مقصف': 'وجبات',
                'إشراف': 'إشراف تربوي',
                'مراقبة': 'إشراف تربوي',
                'أولياء': 'التواصل مع أولياء الأمور',
                'الأهل': 'التواصل مع أولياء الأمور',
                'تواصل': 'طرق التواصل مع الإدارة',
                'اتصال': 'طرق التواصل مع الإدارة',
                'هاتف': 'طرق التواصل مع الإدارة',
                'تلفون': 'طرق التواصل مع الإدارة'
            };

            for (const [keyword, matchKey] of Object.entries(keywords)) {
                if (normalizedQuestion.includes(keyword)) {
                    const foundKey = Object.keys(knowledgeBase).find(function(k) {
                        return k.toLowerCase().includes(matchKey.toLowerCase());
                    });
                    if (foundKey) {
                        return knowledgeBase[foundKey].answer;
                    }
                }
            }

            return null;
        }

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
        }

        function addMessage(content, sender, isHTML) {
            if (welcomeSection && welcomeSection.style.display !== 'none') {
                welcomeSection.style.display = 'none';
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + sender;

            const avatarIcon = sender === 'bot' ? 'fa-robot' : 'fa-user';

            if (isHTML) {
                messageDiv.innerHTML = '<div class="message-avatar"><i class="fas ' + avatarIcon + '"></i></div><div class="message-bubble">' + content + '<span class="message-time">' + getCurrentTime() + '</span></div>';
            } else {
                messageDiv.innerHTML = '<div class="message-avatar"><i class="fas ' + avatarIcon + '"></i></div><div class="message-bubble">' + escapeHTML(content) + '<span class="message-time">' + getCurrentTime() + '</span></div>';
            }

            messagesContainer.appendChild(messageDiv);
            scrollToBottom();

            return messageDiv;
        }

        function escapeHTML(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function scrollToTop() {
            messagesContainer.scrollTop = 0;
        }

        function showTyping() {
            typingIndicator.classList.add('active');
            scrollToBottom();
        }

        function hideTyping() {
            typingIndicator.classList.remove('active');
        }

        function addToHistory(question) {
            questionHistory = questionHistory.filter(function(q) { return q !== question; });
            questionHistory.unshift(question);
            if (questionHistory.length > 10) {
                questionHistory = questionHistory.slice(0, 10);
            }
            renderHistory();
        }

        function renderHistory() {
            if (questionHistory.length === 0) {
                noHistory.style.display = 'block';
                historyList.innerHTML = '';
                historyList.appendChild(noHistory);
                return;
            }

            noHistory.style.display = 'none';
            historyList.innerHTML = questionHistory.map(function(q) {
                return '<div class="history-item" data-question="' + escapeHTML(q) + '"><i class="fas fa-redo"></i><span>' + escapeHTML(q) + '</span></div>';
            }).join('');

            // Add click handlers
            historyList.querySelectorAll('.history-item').forEach(function(item) {
                item.addEventListener('click', function() {
                    askQuestion(this.getAttribute('data-question'));
                });
            });
        }

        function clearHistory() {
            questionHistory = [];
            renderHistory();
        }

        function toggleSidebar() {
            if (window.innerWidth <= 900) {
                sidebar.classList.toggle('open');
                sidebarOverlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
            }
        }

        function toggleCategory(header) {
            const category = header.parentElement;
            category.classList.toggle('open');
        }

        function showWelcome() {
            messagesContainer.innerHTML = '';
            welcomeSection.style.display = 'block';
            messagesContainer.appendChild(welcomeSection);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000;';
            modal.innerHTML = '<div style="background:var(--bg-card);padding:1.5rem;border-radius:16px;max-width:350px;width:90%;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,0.3);"><i class="fas fa-exclamation-circle" style="font-size:3rem;color:var(--warning);margin-bottom:1rem;"></i><p style="color:var(--text-primary);margin-bottom:1.5rem;font-size:1rem;">' + message + '</p><div style="display:flex;gap:0.75rem;justify-content:center;"><button class="cancel-btn" style="padding:0.75rem 1.5rem;border:2px solid var(--border);background:transparent;border-radius:10px;font-family:Tajawal,sans-serif;font-size:0.9rem;color:var(--text-secondary);cursor:pointer;">إلغاء</button><button class="confirm-btn" style="padding:0.75rem 1.5rem;border:none;background:var(--error);border-radius:10px;font-family:Tajawal,sans-serif;font-size:0.9rem;color:#fff;cursor:pointer;">تأكيد</button></div></div>';

            modal.querySelector('.cancel-btn').addEventListener('click', function() {
                modal.remove();
            });

            modal.querySelector('.confirm-btn').addEventListener('click', function() {
                modal.remove();
                onConfirm();
            });

            document.body.appendChild(modal);
        }

        function clearChat() {
            showConfirmDialog('هل أنت متأكد من مسح المحادثة؟', function() {
                showWelcome();
            });
        }

        function askQuestion(question) {
            if (isProcessing) return;

            userInput.value = question;
            sendMessage();
        }

        function sendMessage() {
            const text = userInput.value.trim();
            if (!text || isProcessing) return;

            isProcessing = true;
            addMessage(text, 'user', false);
            addToHistory(text);
            userInput.value = '';
            sendBtn.disabled = true;
            showTyping();

            // Close sidebar on mobile
            if (window.innerWidth <= 900) {
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('active');
            }

            // Find answer from knowledge base
            const answer = findAnswer(text);

            // Simulate typing delay for better UX
            setTimeout(function() {
                hideTyping();

                if (answer) {
                    addMessage(answer, 'bot', true);
                } else {
                    // Default response for unknown questions
                    const defaultResponse = '<h4><i class="fas fa-info-circle"></i> شكراً لتواصلكم</h4><p>نشكركم على سؤالكم. للحصول على إجابة دقيقة حول هذا الاستفسار، يرجى التواصل مباشرة مع إدارة المدرسة.</p><p>يمكنكم أيضاً اختيار أحد الأسئلة الشائعة من القائمة الجانبية للحصول على معلومات فورية.</p>';
                    addMessage(defaultResponse, 'bot', true);
                }

                isProcessing = false;
                sendBtn.disabled = false;
            }, 800);
        }

        // Event Listeners
        toggleSidebarBtn.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);
        homeBtn.addEventListener('click', showWelcome);
        clearBtn.addEventListener('click', clearChat);
        clearHistoryBtn.addEventListener('click', clearHistory);

        sendBtn.addEventListener('click', sendMessage);

        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Category headers
        sidebarContent.querySelectorAll('.category-header').forEach(function(header) {
            header.addEventListener('click', function() {
                toggleCategory(this);
            });
        });

        // Question buttons in sidebar
        sidebarContent.querySelectorAll('.question-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                askQuestion(this.getAttribute('data-question'));
            });
        });

        // Quick action buttons
        quickActions.querySelectorAll('.quick-action-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                askQuestion(this.getAttribute('data-question'));
            });
        });

        // Scroll events
        messagesContainer.addEventListener('scroll', function() {
            const scrolled = messagesContainer.scrollTop > 200;
            scrollTopBtn.classList.toggle('visible', scrolled);
            backToQuestions.classList.toggle('visible', scrolled && welcomeSection.style.display === 'none');
        });

        backToQuestions.addEventListener('click', scrollToTop);
        scrollTopBtn.addEventListener('click', scrollToTop);

        // Focus input on load
        userInput.focus();

        // Initialize history
        renderHistory();
    </script>
</body>
</html>

